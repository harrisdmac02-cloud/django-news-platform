{% extends 'base.html' %}

{% block title %}{{ publisher.name }} Articles - News Platform{% endblock %}

{% block content %}

    <div class="mb-5 text-center">
        <h1 class="fw-bold">{{ publisher.name }}</h1>
        <p class="lead text-muted">Latest published articles from this publisher</p>
    </div>

    {% if articles %}
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
            {% for article in articles %}
                <div class="col">
                    <div class="card h-100 shadow-sm border-0 rounded-4">
                        {% if article.lead_image %}
                            <img src="{{ article.lead_image.image.url }}"
                                 class="card-img-top"
                                 alt="{{ article.title }}"
                                 style="height: 190px; object-fit: cover;">
                        {% endif %}
                        <div class="card-body d-flex flex-column">
                            <h5 class="article-title fw-semibold">
                                <a href="{{ article.get_absolute_url }}" class="text-dark text-decoration-none stretched-link">
                                    {{ article.title }}
                                </a>
                            </h5>
                            <p class="text-muted small mt-2 mb-3">
                                By {{ article.author.get_full_name|default:article.author.username }}
                            </p>
                            <p class="text-secondary flex-grow-1">
                                {{ article.excerpt|truncatewords:30 }}
                            </p>
                            <div class="mt-auto pt-3">
                                <small class="text-muted">{{ article.published_at|date:"d M Y" }}</small>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-center py-5 my-5 bg-light rounded-4">
            <h4 class="text-muted mb-3">No published articles yet</h4>
            <p class="lead text-secondary">
                This publisher hasn't released any articles or they are still under review.
            </p>
        </div>
    {% endif %}

    <!-- Quick subscribe button (only visible to readers) -->
    {% if user.is_authenticated and user.is_reader %}
        <div class="text-center mt-5 pt-4">
            {% if user.subscribed_publishers.filter(pk=publisher.pk).exists %}
                <form action="{% url 'subscribe_publisher' publisher.pk %}" method="post" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-secondary rounded-pill px-5 py-3">
                        Unsubscribe from {{ publisher.name }}
                    </button>
                </form>
            {% else %}
                <form action="{% url 'core:subscribe_publisher' publisher.pk %}" method="post" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-primary rounded-pill px-5 py-3">
                        Subscribe to {{ publisher.name }}
                    </button>
                </form>
            {% endif %}
        </div>
    {% endif %}

{% endblock %}